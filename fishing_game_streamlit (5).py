import streamlit as st
import random
from PIL import Image, ImageDraw, ImageFont
import io

# -------------------- 場所リスト --------------------
locations = [
    "上流", "中流", "下流", "河口",
    "東京湾", "太平洋", "日本海", "瀬戸内海", "相模湾",
    "オホーツク海", "東シナ海", "玄界灘", "大間", "五島列島",
    "積丹半島", "女川港", "大洗港", "城ヶ島", "沼津港",
    "串本", "室戸岬", "枕崎", "糸満漁港"
]

seasons = ["春", "夏", "秋", "冬"]
weathers = ["晴れ", "雨", "曇り"]

# -------------------- 魚画像＆説明辞書 --------------------
fish_info = {
    "イワナ": {"desc": "冷たい清流に住むイワナ。美しい体色が特徴です。"},
    "ヤマメ": {"desc": "渓流釣りで人気のヤマメ。サケ科の淡水魚です。"},
    "ニジマス": {"desc": "派手な虹色模様をもつ美しい魚。養殖も盛ん。"},
    "アマゴ": {"desc": "アマゴは関西地方に多い渓流魚。赤い斑点が特徴。"},
    "オイカワ": {"desc": "婚姻色が美しい小型淡水魚。群れで泳ぎます。"},
    "フナ": {"desc": "日本全国の池や川にいるおなじみの魚。"},
    "ウグイ": {"desc": "幅広い環境に適応できる淡水魚。婚姻色は赤くなる。"},
    "ナマズ": {"desc": "夜行性で口ひげが特徴。雷魚と混同されがち。"},
    "ボラ": {"desc": "汽水域に多く、群れで泳ぐ魚。成魚は大型になります。"},
    "スズキ": {"desc": "釣りでも食でも人気の白身魚。成長と共に名前が変わる出世魚。"},
    "ハゼ": {"desc": "汽水域で釣れる小型魚。天ぷらが美味。"},
    "シーバス": {"desc": "ルアー釣りのターゲット。別名スズキ。"},
    "クロダイ": {"desc": "磯釣りの代表格。力強い引きが魅力です。"},
    "キス": {"desc": "砂浜で投げ釣りで狙う人気の魚。白身が上品な味わい。"},
    "アジ": {"desc": "釣り初心者にも人気の青魚。脂がのった味わい。"},
    "カサゴ": {"desc": "岩礁に潜む小型の根魚。煮付けが美味しい。"},
    "メバル": {"desc": "夜釣りで人気の根魚。暗い所を好む。"},
    "カツオ": {"desc": "回遊魚の代表格。刺身やたたきで人気。"},
    "シイラ": {"desc": "鮮やかな体色が美しい大型魚。夏に多く釣れる。"},
    "ブリ": {"desc": "出世魚として有名。冬の寒ブリが特に美味。"},
    "ヒラメ": {"desc": "平たい体と隠れる習性。刺身が絶品。"},
    "タチウオ": {"desc": "刀のような見た目。夜釣りの人気者。"}
}

# -------------------- 画像生成 --------------------
def generate_fish_image(fish_name):
    img = Image.new("RGB", (400, 200), color=(135, 206, 250))  # 空色背景
    draw = ImageDraw.Draw(img)
    draw.rectangle([20, 60, 380, 140], fill=(255, 255, 255), outline=(0, 0, 0))  # 魚の形
    draw.text((150, 90), fish_name, fill=(0, 0, 0))
    buf = io.BytesIO()
    img.save(buf, format="PNG")
    buf.seek(0)
    return buf

# -------------------- UI --------------------
st.title("🎣 日本の釣りゲーム")

location = st.selectbox("釣り場を選んでください", locations)
season = st.selectbox("季節を選んでください", seasons)
weather = st.selectbox("天気を選んでください", weathers)

# 例：釣果データ（簡易版）
example_fish_data = {
    ("上流", "春", "晴れ"): ["イワナ", "ヤマメ"],
    ("中流", "春", "晴れ"): ["オイカワ", "フナ"],
    ("東京湾", "夏", "晴れ"): ["アジ", "カツオ"]
}

if st.button("釣りをする！"):
    fish_list = example_fish_data.get((location, season, weather), [])
    if fish_list:
        caught = random.choice(fish_list)
        st.success(f"おめでとう！{caught}が釣れました！")

        # 描画された魚画像を表示
        st.image(generate_fish_image(caught), caption=f"{caught}のイメージ", use_column_width=False)

        # 魚の説明
        st.caption(fish_info.get(caught, {}).get("desc", "説明なし"))
    else:
        st.info("魚が釣れませんでした。別の条件で試してみましょう！")
